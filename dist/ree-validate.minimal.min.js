!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ReeValidate=e()}(this,function(){"use strict";var t=function(t){return null===t||void 0===t},e=function(t,e,i){return t.setAttribute("data-vv-"+e,i)},i=function(t,e,i){if(void 0===i&&(i=void 0),!t||!e)return i;var s=e;return t.split(".").every(function(t){return Object.prototype.hasOwnProperty.call(s,t)||void 0!==s[t]?(s=s[t],!0):(s=i,!1)}),s},s=function(t){var e=[],i=t.split(":")[0];return~t.indexOf(":")&&(e=t.split(":").slice(1).join(":").split(",")),{name:i,params:e}},n=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=!1),0===e)return t;var s;return function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];var a=i&&!s;clearTimeout(s),s=setTimeout(function(){s=null,i||t.apply(void 0,n)},e),a&&t.apply(void 0,n)}},r=function(t){return t?u(t)?Object.keys(t).reduce(function(e,i){var s=[];return s=!0===t[i]?[]:Array.isArray(t[i])?t[i]:[t[i]],!1!==t[i]&&(e[i]=s),e},{}):"string"!=typeof t?(a("rules must be either a string or an object."),{}):t.split("|").reduce(function(t,e){var i=s(e);return i.name?(t[i.name]=i.params,t):t},{}):{}},a=function(t){console.warn("[ree-validate] "+t)},o=function(t){return new Error("[ree-validate] "+t)},u=function(t){return null!==t&&t&&"object"==typeof t&&!Array.isArray(t)},l=function(t){return"function"==typeof t},c=function(t,e){return t.classList?t.classList.contains(e):!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},d=function(t,e){t.classList?t.classList.add(e):c(t,e)||(t.className+=" "+e)},h=function(t,e){if(t.classList)t.classList.remove(e);else if(c(t,e)){var i=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(i," ")}},f=function(t,e,i){if(t&&e)return i?d(t,e):void h(t,e)},p=function(t){if(l(Array.from))return Array.from(t);for(var e=[],i=t.length,s=0;s<i;s++)e.push(t[s]);return e},m=function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];if(l(Object.assign))return Object.assign.apply(Object,[t].concat(e));if(null==t)throw new TypeError("Cannot convert undefined or null to object");var s=Object(t);return e.forEach(function(t){null!=t&&Object.keys(t).forEach(function(e){s[e]=t[e]})}),s},v=function(){return"_"+Math.random().toString(36).substr(2,9)},g=function(t,e){var i=p(t);if(l(i.find))return i.find(e);var s;return i.some(function(t){return!!e(t)&&(s=t,!0)}),s},y=function(t){return t&&("SELECT"===t.tagName||~["radio","checkbox","file"].indexOf(t.type))?"change":"input"},b=function(){this.items=[]};b.prototype.add=function(e){arguments.length>1&&(e={field:arguments[0],msg:arguments[1],rule:arguments[2],scope:t(arguments[3])?null:arguments[3]}),e.scope=t(e.scope)?null:e.scope,this.items.push(e)},b.prototype.update=function(t,e){var i=g(this.items,function(e){return e.id===t});if(i){var s=this.items.indexOf(i);this.items.splice(s,1),i.scope=e.scope,this.items.push(i)}},b.prototype.all=function(e){return t(e)?this.items.map(function(t){return t.msg}):this.items.filter(function(t){return t.scope===e}).map(function(t){return t.msg})},b.prototype.any=function(e){return t(e)?!!this.items.length:!!this.items.filter(function(t){return t.scope===e}).length},b.prototype.clear=function(e){var i=this;t(e)&&(e=null);for(var s=0;s<this.items.length;++s)i.items[s].scope===e&&(i.items.splice(s,1),--s)},b.prototype.collect=function(e,i,s){if(void 0===s&&(s=!0),!e){var n={};return this.items.forEach(function(t){n[t.field]||(n[t.field]=[]),n[t.field].push(s?t.msg:t)}),n}return e=t(e)?e:String(e),t(i)?this.items.filter(function(t){return t.field===e}).map(function(t){return s?t.msg:t}):this.items.filter(function(t){return t.field===e&&t.scope===i}).map(function(t){return s?t.msg:t})},b.prototype.count=function(){return this.items.length},b.prototype.firstById=function(t){var e=g(this.items,function(e){return e.id===t});return e?e.msg:null},b.prototype.first=function(e,i){var s=this;void 0===i&&(i=null),e=t(e)?e:String(e);var n=this._selector(e),r=this._scope(e);if(r){var a=this.first(r.name,r.scope);if(a)return a}if(n)return this.firstByRule(n.name,n.rule,i);for(var o=0;o<this.items.length;++o)if(s.items[o].field===e&&s.items[o].scope===i)return s.items[o].msg;return null},b.prototype.firstRule=function(t,e){var i=this.collect(t,e,!1);return i.length&&i[0].rule||null},b.prototype.has=function(t,e){return void 0===e&&(e=null),!!this.first(t,e)},b.prototype.firstByRule=function(t,e,i){void 0===i&&(i=null);var s=this.collect(t,i,!1).filter(function(t){return t.rule===e})[0];return s&&s.msg||null},b.prototype.firstNot=function(t,e,i){void 0===e&&(e="required"),void 0===i&&(i=null);var s=this.collect(t,i,!1).filter(function(t){return t.rule!==e})[0];return s&&s.msg||null},b.prototype.removeById=function(t){for(var e=this,i=0;i<this.items.length;++i)e.items[i].id===t&&(e.items.splice(i,1),--i)},b.prototype.remove=function(e,i,s){var n=this;e=t(e)?e:String(e);for(var r=0;r<this.items.length;++r)(function(n){return n.id&&s?n.id===s:t(i)?n.field===e&&null===n.scope:n.field===e&&n.scope===i})(n.items[r])&&(n.items.splice(r,1),--r)},b.prototype._selector=function(t){if(t.indexOf(":")>-1){var e=t.split(":");return{name:e[0],rule:e[1]}}return null},b.prototype._scope=function(t){if(t.indexOf(".")>-1){var e=t.split("."),i=e[0];return{name:e.slice(1).join("."),scope:i}}return null};var _=function(t){void 0===t&&(t={}),this.container={},this.merge(t)};_.prototype.hasLocale=function(t){return!!this.container[t]},_.prototype.setDateFormat=function(t,e){this.container[t]||(this.container[t]={}),this.container[t].dateFormat=e},_.prototype.getDateFormat=function(t){if(this.container[t])return this.container[t].dateFormat},_.prototype.getMessage=function(t,e,i){return this.hasMessage(t,e)?this.container[t].messages[e]:i||this._getDefaultMessage(t)},_.prototype.getFieldMessage=function(t,e,i){if(!this.hasLocale(t))return this.getMessage(t,i);var s=this.container[t].custom&&this.container[t].custom[e];return s&&s[i]?s[i]:this.getMessage(t,i)},_.prototype._getDefaultMessage=function(t){return this.hasMessage(t,"_default")?this.container[t].messages._default:this.container.en.messages._default},_.prototype.getAttribute=function(t,e,i){return void 0===i&&(i=""),this.hasAttribute(t,e)?this.container[t].attributes[e]:i},_.prototype.hasMessage=function(t,e){return!!(this.hasLocale(t)&&this.container[t].messages&&this.container[t].messages[e])},_.prototype.hasAttribute=function(t,e){return!!(this.hasLocale(t)&&this.container[t].attributes&&this.container[t].attributes[e])},_.prototype.merge=function(t){this._merge(this.container,t)},_.prototype.setMessage=function(t,e,i){this.hasLocale(t)||(this.container[t]={messages:{},attributes:{}}),this.container[t].messages[e]=i},_.prototype.setAttribute=function(t,e,i){this.hasLocale(t)||(this.container[t]={messages:{},attributes:{}}),this.container[t].attributes[e]=i},_.prototype._merge=function(t,e){var i=this;return u(t)&&u(e)?(Object.keys(e).forEach(function(s){if(u(e[s])){if(!t[s]){m(t,(n={},n[s]={},n));var n}i._merge(t[s],e[s])}else{m(t,(r={},r[s]=e[s],r));var r}}),t):t};var w={targetOf:null,initial:!1,scope:null,listen:!0,name:null,active:!0,required:!1,rules:{},vm:null,classes:!1,validity:!0,aria:!0,events:"input|blur",delay:0,classNames:{touched:"touched",untouched:"untouched",valid:"valid",invalid:"invalid",pristine:"pristine",dirty:"dirty"}},E=function(t,s){void 0===s&&(s={}),this.id=v(),this.el=t,this.updated=!1,this.dependencies=[],this.watchers=[],this.events=[],this.rules={},this.isHeadless||s.targetOf||e(this.el,"id",this.id),s=m({},w,s),this.validity=s.validity,this.aria=s.aria,this.flags={untouched:!0,touched:!1,dirty:!1,pristine:!0,valid:null,invalid:null,validated:!1,pending:!1,required:!1},this.vm=s.vm,this.component=s.component,this.ctorConfig=this.component?i("$options.$_reeValidate",this.component):void 0,this.update(s),this.updated=!1},A={isVue:{configurable:!0},validator:{configurable:!0},isRequired:{configurable:!0},isDisabled:{configurable:!0},isHeadless:{configurable:!0},displayName:{configurable:!0},value:{configurable:!0},rejectsFalse:{configurable:!0}};A.isVue.get=function(){return!!this.component},A.validator.get=function(){return this.vm&&this.vm.$validator?this.vm.$validator:(a("No validator instance detected."),{validate:function(){}})},A.isRequired.get=function(){return!!this.rules.required},A.isDisabled.get=function(){return!(!this.component||!this.component.disabled)||!(!this.el||!this.el.disabled)},A.isHeadless.get=function(){return!this.el},A.displayName.get=function(){return l(this.alias)?this.alias():this.alias},A.value.get=function(){if(l(this.getter))return this.getter()},A.rejectsFalse.get=function(){return this.isVue&&this.ctorConfig?!!this.ctorConfig.rejectsFalse:!this.isHeadless&&"checkbox"===this.el.type},E.prototype.matches=function(t){return t.id?this.id===t.id:void 0===t.name&&void 0===t.scope||(void 0===t.scope?this.name===t.name:void 0===t.name?this.scope===t.scope:t.name===this.name&&t.scope===this.scope)},E.prototype.update=function(e){this.targetOf=e.targetOf||null,this.initial=e.initial||this.initial||!1,this.updated&&!t(e.scope)&&e.scope!==this.scope&&l(this.validator.update)&&this.validator.update(this.id,{scope:e.scope}),this.scope=t(e.scope)?t(this.scope)?null:this.scope:e.scope,this.name=(t(e.name)?e.name:String(e.name))||this.name||null,this.rules=void 0!==e.rules?r(e.rules):this.rules,this.model=e.model||this.model,this.listen=void 0!==e.listen?e.listen:this.listen,this.classes=e.classes||this.classes||!1,this.classNames=e.classNames||this.classNames||w.classNames,this.alias=e.alias||this.alias,this.getter=l(e.getter)?e.getter:this.getter,this.delay=e.delay||this.delay||0,this.events="string"==typeof e.events&&e.events.length?e.events.split("|"):this.events,this.addActionListeners(),void 0!==e.rules&&(this.flags.required=this.isRequired),this.flags.validated&&void 0!==e.rules&&this.updated&&this.validator.validate("#"+this.id),this.updated=!0,this.isHeadless||(this.updateClasses(),this.addValueListeners(),this.updateAriaAttrs())},E.prototype.reset=function(){var t=this,e={untouched:!0,touched:!1,dirty:!1,pristine:!0,valid:null,invalid:null,validated:!1,pending:!1,required:!1};Object.keys(this.flags).forEach(function(i){t.flags[i]=e[i]}),this.addActionListeners(),this.updateClasses(),this.updateAriaAttrs(),this.updateCustomValidity()},E.prototype.setFlags=function(t){var e=this,i={pristine:"dirty",dirty:"pristine",valid:"invalid",invalid:"valid",touched:"untouched",untouched:"touched"};Object.keys(t).forEach(function(s){e.flags[s]=t[s],i[s]&&void 0===t[i[s]]&&(e.flags[i[s]]=!t[s])}),void 0===t.untouched&&void 0===t.touched&&void 0===t.dirty&&void 0===t.pristine||this.addActionListeners(),this.updateClasses(),this.updateAriaAttrs(),this.updateCustomValidity()},E.prototype.unwatch=function(t){if(void 0===t&&(t=null),!t)return this.watchers.forEach(function(t){return t.unwatch()}),void(this.watchers=[]);this.watchers.filter(function(e){return t.test(e.tag)}).forEach(function(t){return t.unwatch()}),this.watchers=this.watchers.filter(function(e){return!t.test(e.tag)})},E.prototype.updateClasses=function(){this.classes&&(f(this.el,this.classNames.dirty,this.flags.dirty),f(this.el,this.classNames.pristine,this.flags.pristine),f(this.el,this.classNames.valid,!!this.flags.valid),f(this.el,this.classNames.invalid,!!this.flags.invalid),f(this.el,this.classNames.touched,this.flags.touched),f(this.el,this.classNames.untouched,this.flags.untouched))},E.prototype.addActionListeners=function(){var t=this;this.unwatch(/class/);var e=function(){t.flags.touched=!0,t.flags.untouched=!1,t.classes&&(f(t.el,t.classNames.touched,!0),f(t.el,t.classNames.untouched,!1)),t.unwatch(/^class_blur$/)},i=y(this.el),s=function(){t.flags.dirty=!0,t.flags.pristine=!1,t.classes&&(f(t.el,t.classNames.pristine,!1),f(t.el,t.classNames.dirty,!0)),t.unwatch(/^class_input$/)};if(this.isVue&&l(this.component.$once))return this.component.$once("input",s),this.component.$once("blur",e),this.watchers.push({tag:"class_input",unwatch:function(){t.component.$off("input",s)}}),void this.watchers.push({tag:"class_blur",unwatch:function(){t.component.$off("blur",e)}});if(!this.isHeadless){this.el.addEventListener(i,s);var n=-1===["radio","checkbox"].indexOf(this.el.type)?"blur":"click";this.el.addEventListener(n,e),this.watchers.push({tag:"class_input",unwatch:function(){t.el.removeEventListener(i,s)}}),this.watchers.push({tag:"class_blur",unwatch:function(){t.el.removeEventListener(n,e)}})}},E.prototype.addValueListeners=function(){var t=this;if(this.unwatch(/^input_.+/),this.listen){var e=this.targetOf?function(){t.validator.validate("#"+t.targetOf)}:function(){for(var e=[],i=arguments.length;i--;)e[i]=arguments[i];(0===e.length||l(Event)&&e[0]instanceof Event||e[0]&&e[0].srcElement)&&(e[0]=t.value),t.validator.validate("#"+t.id,e[0])},i=n(e,this.delay),s=y(this.el),r=this.events.map(function(t){return"input"===t?s:t});if(this.model&&-1!==r.indexOf(s)){var a=this.vm.$watch(this.model,i);this.watchers.push({tag:"input_model",unwatch:a}),r=r.filter(function(t){return t!==s})}r.forEach(function(e){if(t.isVue)return t.component.$on(e,i),void t.watchers.push({tag:"input_vue",unwatch:function(){t.component.$off(e,i)}});if(~["radio","checkbox"].indexOf(t.el.type)){var s=document.querySelectorAll('input[name="'+t.el.name+'"]');p(s).forEach(function(s){s.addEventListener(e,i),t.watchers.push({tag:"input_native",unwatch:function(){s.removeEventListener(e,i)}})})}else t.el.addEventListener(e,i),t.watchers.push({tag:"input_native",unwatch:function(){t.el.removeEventListener(e,i)}})})}},E.prototype.updateAriaAttrs=function(){this.aria&&!this.isHeadless&&l(this.el.setAttribute)&&(this.el.setAttribute("aria-required",this.isRequired?"true":"false"),this.el.setAttribute("aria-invalid",this.flags.invalid?"true":"false"))},E.prototype.updateCustomValidity=function(){this.validity&&!this.isHeadless&&l(this.el.setCustomValidity)&&this.el.setCustomValidity(this.flags.valid?"":this.validator.errors.firstById(this.id)||"")},E.prototype.destroy=function(){this.watchers.forEach(function(t){return t.unwatch()}),this.watchers=[],this.dependencies.forEach(function(t){return t.field.destroy()}),this.dependencies=[]},Object.defineProperties(E.prototype,A);var O=function(){this.items=[]},F={length:{configurable:!0}};F.length.get=function(){return this.items.length},O.prototype.find=function(t){return g(this.items,function(e){return e.matches(t)})},O.prototype.filter=function(t){return Array.isArray(t)?this.items.filter(function(e){return t.some(function(t){return e.matches(t)})}):this.items.filter(function(e){return e.matches(t)})},O.prototype.map=function(t){return this.items.map(t)},O.prototype.remove=function(t){var e=null;if(!(e=t instanceof E?t:this.find(t)))return null;var i=this.items.indexOf(e);return this.items.splice(i,1),e},O.prototype.push=function(t){if(!(t instanceof E))throw o("FieldBag only accepts instances of Field that has an id defined.");if(!t.id)throw o("Field id must be defined.");if(this.find({id:t.id}))throw o("Field with id "+t.id+" is already added.");this.items.push(t)},Object.defineProperties(O.prototype,F);var x={},L="en",j=!0,N=new _({en:{messages:{},attributes:{},custom:{}}}),$=function(t,e){var i=this;void 0===e&&(e={vm:null,fastExit:!0}),this.strict=j,this.errors=new b,this.fields=new O,this.flags={},this._createFields(t),this.paused=!1,this.fastExit=e.fastExit||!1,this.ownerId=e.vm&&e.vm._uid,this.reset=e.vm&&l(e.vm.$nextTick)?function(){e.vm.$nextTick(function(){i.fields.items.forEach(function(t){return t.reset()}),i.errors.clear()})}:function(){i.fields.items.forEach(function(t){return t.reset()}),i.errors.clear()},this.clean=function(){a("validator.clean is marked for deprecation, please use validator.reset instead."),i.reset()}},D={dictionary:{configurable:!0},locale:{configurable:!0},rules:{configurable:!0}},M={dictionary:{configurable:!0},locale:{configurable:!0},rules:{configurable:!0}};D.dictionary.get=function(){return N},M.dictionary.get=function(){return N},D.locale.get=function(){return L},D.locale.set=function(t){$.locale=t},M.locale.get=function(){return L},M.locale.set=function(t){N.hasLocale(t)||a("You are setting the validator locale to a locale that is not defined in the dictionary. English messages may still be generated."),L=t},D.rules.get=function(){return x},M.rules.get=function(){return x},$.create=function(t,e){return new $(t,e)},$.extend=function(t,e){$._guardExtend(t,e),$._merge(t,e)},$.remove=function(t){delete x[t]},$.setLocale=function(t){void 0===t&&(t="en"),$.locale=t},$.installDateTimeValidators=function(){a("Date validations are now installed by default, you no longer need to install it.")},$.prototype.installDateTimeValidators=function(){a("Date validations are now installed by default, you no longer need to install it.")},$.setStrictMode=function(t){void 0===t&&(t=!0),j=t},$.updateDictionary=function(t){N.merge(t)},$.addLocale=function(t){if(t.name){this.updateDictionary((e={},e[t.name]=t,e));var e}else a("Your locale must have a name property")},$.prototype.addLocale=function(t){$.addLocale(t)},$.prototype.localize=function(t,e){$.localize(t,e)},$.localize=function(t,e){e&&(e=m({},e,{name:t}),$.addLocale(e)),$.locale=t},$.prototype.attach=function(t){arguments.length>1&&(t=m({},{name:arguments[0],rules:arguments[1]},arguments[2]||{vm:{$validator:this}}));var e=t.initialValue;return t instanceof E||(t=new E(t.el||null,t)),this.fields.push(t),t.initial?this.validate("#"+t.id,e||t.value):this._validate(t,e||t.value,!0).then(function(e){t.flags.valid=e,t.flags.invalid=!e}),this._addFlag(t,t.scope),t},$.prototype.flag=function(t,e){var i=this._resolveField(t);i&&e&&i.setFlags(e)},$.prototype.detach=function(e,i){var s=e instanceof E?e:this._resolveField(e,i);if(s){s.destroy(),this.errors.remove(s.name,s.scope,s.id),this.fields.remove(s);var n=this.flags;!t(s.scope)&&n["$"+s.scope]?delete n["$"+s.scope][s.name]:t(s.scope)&&delete n[s.name],this.flags=m({},n)}},$.prototype.extend=function(t,e){$.extend(t,e)},$.prototype.update=function(e,i){var s=i.scope,n=this._resolveField("#"+e);this.errors.update(e,{scope:s}),!t(n.scope)&&this.flags["$"+n.scope]?delete this.flags["$"+n.scope][n.name]:t(n.scope)&&delete this.flags[n.name],this._addFlag(n,s)},$.prototype.remove=function(t){$.remove(t)},$.prototype.setLocale=function(t){this.locale=t},$.prototype.updateDictionary=function(t){$.updateDictionary(t)},$.prototype.validate=function(t,e,i){if(void 0===i&&(i=null),this.paused)return Promise.resolve(!0);if(0===arguments.length)return this.validateScopes();if(1===arguments.length&&"*"===arguments[0])return this.validateAll();if(1===arguments.length&&"string"==typeof arguments[0]&&/^(.+)\.\*$/.test(arguments[0])){var s=arguments[0].match(/^(.+)\.\*$/)[1];return this.validateAll(s)}var n=this._resolveField(t,i);if(!n)return this._handleFieldNotFound(t,i);this.errors.remove(n.name,n.scope,n.id),n.flags.pending=!0,1===arguments.length&&(e=n.value);var r=n.isDisabled;return this._validate(n,e,r).then(function(t){return n.setFlags({pending:!1,valid:t,validated:!0}),r?Promise.resolve(!0):t})},$.prototype.pause=function(){return this.paused=!0,this},$.prototype.resume=function(){return this.paused=!1,this},$.prototype.validateAll=function(t){var e=arguments,i=this;if(this.paused)return Promise.resolve(!0);var s=null,n=!1;"string"==typeof t?s={scope:t}:u(t)?(s=Object.keys(t).map(function(t){return{name:t,scope:e[1]||null}}),n=!0):0===arguments.length?s={scope:null}:Array.isArray(t)&&(s=t.map(function(t){return{name:t,scope:e[1]||null}}));var r=this.fields.filter(s).map(function(e){return i.validate("#"+e.id,n?t[e.name]:e.value)});return Promise.all(r).then(function(t){return t.every(function(t){return t})})},$.prototype.validateScopes=function(){var t=this;if(this.paused)return Promise.resolve(!0);var e=this.fields.map(function(e){return t.validate("#"+e.id,e.value)});return Promise.all(e).then(function(t){return t.every(function(t){return t})})},$.prototype._createFields=function(t){var e=this;t&&Object.keys(t).forEach(function(i){var s=m({},{name:i,rules:t[i]});e.attach(s)})},$.prototype._getDateFormat=function(t){var e=null;return t.date_format&&Array.isArray(t.date_format)&&(e=t.date_format[0]),e||this.dictionary.getDateFormat(this.locale)},$.prototype._isADateRule=function(t){return!!~["after","before","date_between","date_format"].indexOf(t)},$.prototype._formatErrorMessage=function(t,e,i,s){void 0===i&&(i={}),void 0===s&&(s=null);var n=this._getFieldDisplayName(t),r=this._getLocalizedParams(e,s);if(!this.dictionary.hasLocale(L)){var a=this.dictionary.getFieldMessage("en",t.name,e.name);return l(a)?a(n,r,i):a}var o=this.dictionary.getFieldMessage(L,t.name,e.name);return l(o)?o(n,r,i):o},$.prototype._getLocalizedParams=function(t,e){return void 0===e&&(e=null),~["after","before","confirmed"].indexOf(t.name)&&t.params&&t.params[0]?[e||this.dictionary.getAttribute(L,t.params[0],t.params[0])].concat(t.params.slice(1)):t.params},$.prototype._getFieldDisplayName=function(t){return t.displayName||this.dictionary.getAttribute(L,t.name,t.name)},$.prototype._addFlag=function(e,i){if(void 0===i&&(i=null),t(i)){this.flags=m({},this.flags,(s={},s[""+e.name]=e.flags,s));var s}else{var n,r=m({},this.flags["$"+i]||{},(n={},n[""+e.name]=e.flags,n));this.flags=m({},this.flags,(a={},a["$"+i]=r,a));var a}},$.prototype._test=function(t,e,i,s){var n=this,r=x[i.name],a=Array.isArray(i.params)?p(i.params):[],c=null;if(!r||"function"!=typeof r)throw o("No such validator '"+i.name+"' exists.");if(/(confirmed|after|before)/.test(i.name)){var d=g(t.dependencies,function(t){return t.name===i.name});d&&(c=d.field.displayName,a=[d.field.value].concat(a.slice(1)))}else"required"===i.name&&t.rejectsFalse&&(a=a.length?a:[!0]);if(this._isADateRule(i.name)){var h=this._getDateFormat(t.rules);"date_format"!==i.name&&a.push(h)}var f=r(e,a);return l(f.then)?f.then(function(e){var r=!0,a={};return Array.isArray(e)?r=e.every(function(t){return u(t)?t.valid:t}):(r=u(e)?e.valid:e,a=e.data),r||s||n.errors.add({id:t.id,field:t.name,msg:n._formatErrorMessage(t,i,a,c),rule:i.name,scope:t.scope}),r}):(u(f)||(f={valid:f,data:{}}),f.valid||s||this.errors.add({id:t.id,field:t.name,msg:this._formatErrorMessage(t,i,f.data,c),rule:i.name,scope:t.scope}),f.valid)},$._merge=function(t,e){l(e)?x[t]=e:(x[t]=e.validate,l(e.getMessage)&&N.setMessage(L,t,e.getMessage),e.messages&&N.merge(Object.keys(e.messages).reduce(function(i,s){var n=i;n[s]={messages:(r={},r[t]=e.messages[s],r)};var r;return n},{})))},$._guardExtend=function(t,e){if(!l(e)){if(!l(e.validate))throw o("Extension Error: The validator '"+t+"' must be a function or have a 'validate' method.");if(!l(e.getMessage)&&!u(e.messages))throw o("Extension Error: The validator '"+t+"' must have a 'getMessage' method or have a 'messages' object.")}},$.prototype._resolveField=function(e,i){if(!t(i))return this.fields.find({name:e,scope:i});if("#"===e[0])return this.fields.find({id:e.slice(1)});if(e.indexOf(".")>-1){var s=e.split("."),n=s[0],r=s.slice(1),a=this.fields.find({name:r.join("."),scope:n});if(a)return a}return this.fields.find({name:e,scope:null})},$.prototype._handleFieldNotFound=function(e,i){if(!this.strict)return Promise.resolve(!0);var s=t(i)?e:(t(i)?"":i+".")+e;throw o('Validating a non-existent field: "'+s+'". Use "attach()" first.')},$.prototype._validate=function(e,i,s){var n=this;if(void 0===s&&(s=!1),!e.isRequired&&(t(i)||""===i))return Promise.resolve(!0);var r=[],a=!1;return Object.keys(e.rules).some(function(t){var o=n._test(e,i,{name:t,params:e.rules[t]},s);if(l(o.then))r.push(o);else if(n.fastExit&&!o)a=!0;else{var u=new Promise(function(t){t(o)});r.push(u)}return a}),a?Promise.resolve(!1):Promise.all(r).then(function(t){return t.every(function(t){return t})})},Object.defineProperties($.prototype,D),Object.defineProperties($,M);var V=function(t){return Array.isArray(t)?t.reduce(function(t,e){return~e.indexOf(".")?t[e.split(".")[1]]=e:t[e]=e,t},{}):t};return{use:function(t,e){if(void 0===e&&(e={}),!l(t))return a("The plugin must be a callable function");t({Validator:$,ErrorBag:b,Rules:$.rules},e)},mapFields:function(t){var e=V(t);return Object.keys(e).reduce(function(t,i){var s=e[i];return t[i]=function(){if(this.$validator.flags[s])return this.$validator.flags[s];if(s.indexOf(".")<=0)return{};var t=s.split("."),e=t[0],i=t.slice(1);return e=this.$validator.flags["$"+e],i=i.join("."),e&&e[i]?e[i]:{}},t},{})},Validator:$,ErrorBag:b,version:"2.0.0"}});